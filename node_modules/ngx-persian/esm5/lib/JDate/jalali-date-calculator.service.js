/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { div, mod } from './ArithmeticUtils';
import { InvalidJalaliDateError } from './InvalidJalaliDate.error';
import { JalaliDateValidatorService } from './jalali-date-validator.service';
import * as i0 from "@angular/core";
import * as i1 from "./jalali-date-validator.service";
/**
 * This class converts Jalali date to Georgian and vase versa. You can use all of the methods as static methods.
 *
 */
var JalaliDateCalculatorService = /** @class */ (function () {
    function JalaliDateCalculatorService(validator) {
        this.validator = validator;
    }
    /**
     * Calculates the Julian Day number from Gregorian or Julian calendar dates.
     *
     * Only some code cleaning applied to the source code.
     *
     * The procedure was tested to be good since 1 March, -100100 (of both calendars) up to a few million years into the future.
     *
     * @param gDate an instance of javascript date representing a Georgian date.
     *
     * [Implementation in source code]{@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L195}
  
     */
    /**
     * Calculates the Julian Day number from Gregorian or Julian calendar dates.
     *
     * Only some code cleaning applied to the source code.
     *
     * The procedure was tested to be good since 1 March, -100100 (of both calendars) up to a few million years into the future.
     *
     * @param {?} gDate an instance of javascript date representing a Georgian date.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L195}
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.numberOfPassedGDays = /**
     * Calculates the Julian Day number from Gregorian or Julian calendar dates.
     *
     * Only some code cleaning applied to the source code.
     *
     * The procedure was tested to be good since 1 March, -100100 (of both calendars) up to a few million years into the future.
     *
     * @param {?} gDate an instance of javascript date representing a Georgian date.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L195}
     * @return {?}
     */
    function (gDate) {
        /** @type {?} */
        var gMonth = gDate.getMonth() - 7;
        /** @type {?} */
        var gYear = gDate.getFullYear() + 100100;
        /** @type {?} */
        var gMonthDiv = div(gMonth, 6);
        /** @type {?} */
        var result = div((gYear + gMonthDiv) * 1461, 4) + div(153 * mod(gMonth + 17, 12) + 2, 5) + gDate.getDate() - 34840408;
        return result - div(div(gYear + gMonthDiv, 100) * 3, 4) + 752;
    };
    /**
     * Returns number of passed days from source day in jalali calendar to the given jalali date.
     * @param jYear full jalali year like 1397
     * @param jMonth starts from zero
     * @param jDay day number starts from one
     */
    /**
     * Returns number of passed days from source day in jalali calendar to the given jalali date.
     * @param {?} jYear full jalali year like 1397
     * @param {?} jMonth starts from zero
     * @param {?} jDay day number starts from one
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.numberOfPassedJDays = /**
     * Returns number of passed days from source day in jalali calendar to the given jalali date.
     * @param {?} jYear full jalali year like 1397
     * @param {?} jMonth starts from zero
     * @param {?} jDay day number starts from one
     * @return {?}
     */
    function (jYear, jMonth, jDay) {
        return this.numberOfPassedGDays(new Date(this.jalaliYearToGeorgianYear(jYear), 2, this.firstDayOfJYearInMarch(jYear))) +
            jMonth * 31 - div(jMonth + 1, 7) * (jMonth - 6) + jDay - 1;
    };
    /**
     * Creates a javascript Date object from number of passed days in Georgian calendar representing Georgian date.
     *
     * [Implementation in source code]{@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L213}
     */
    /**
     * Creates a javascript Date object from number of passed days in Georgian calendar representing Georgian date.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L213}
     * @param {?} numOfDays
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.createGDateFromDays = /**
     * Creates a javascript Date object from number of passed days in Georgian calendar representing Georgian date.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L213}
     * @param {?} numOfDays
     * @return {?}
     */
    function (numOfDays) {
        /** @type {?} */
        var j = (4 * numOfDays + 139361631) + div(div(4 * numOfDays + 183187720, 146097) * 3, 4) * 4 - 3908;
        /** @type {?} */
        var i = div(mod(j, 1461), 4) * 5 + 308;
        /** @type {?} */
        var gDay = div(mod(i, 153), 5) + 1;
        /** @type {?} */
        var gMonth = mod(div(i, 153), 12);
        /** @type {?} */
        var gYear = div(j, 1461) - 100100 + div(7 - gMonth, 6);
        return new Date(gYear, gMonth, gDay);
    };
    /**
     * This function returns number of passed leap years from AD 621 until targetGYear.
     * @param targetGYear is full year number like 2018
     *
     * [Implementation in source code]{@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L110}
     */
    /**
     * This function returns number of passed leap years from AD 621 until targetGYear.
     * @param {?} targetGYear is full year number like 2018
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L110}
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.numOfGLeapYears = /**
     * This function returns number of passed leap years from AD 621 until targetGYear.
     * @param {?} targetGYear is full year number like 2018
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L110}
     * @return {?}
     */
    function (targetGYear) {
        return div(targetGYear, 4) - div((div(targetGYear, 100) + 1) * 3, 4) - 150;
    };
    /**
     * first day of the Farvardin month in Jalali calendar is in March month. This method returns the day number of new jalali year in March.
     * The day number starts from 1 not zero and is equal to the real numbers in the calendar.
     * @param jYear full jalali year like 1397
     */
    /**
     * first day of the Farvardin month in Jalali calendar is in March month. This method returns the day number of new jalali year in March.
     * The day number starts from 1 not zero and is equal to the real numbers in the calendar.
     * @param {?} jYear full jalali year like 1397
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.firstDayOfJYearInMarch = /**
     * first day of the Farvardin month in Jalali calendar is in March month. This method returns the day number of new jalali year in March.
     * The day number starts from 1 not zero and is equal to the real numbers in the calendar.
     * @param {?} jYear full jalali year like 1397
     * @return {?}
     */
    function (jYear) {
        /** @type {?} */
        var gYear = jYear + 621;
        return this.validator.numOfJLeapYears(jYear) - this.numOfGLeapYears(gYear) + 20;
    };
    /**
     * Converts jalali year number to the georgian year. Output year is the georgian year that jalali year starts within it, not the year
     * that starts in the winter of jalali year.
     * @param jYear full jalali year like 1397
     */
    /**
     * Converts jalali year number to the georgian year. Output year is the georgian year that jalali year starts within it, not the year
     * that starts in the winter of jalali year.
     * @param {?} jYear full jalali year like 1397
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.jalaliYearToGeorgianYear = /**
     * Converts jalali year number to the georgian year. Output year is the georgian year that jalali year starts within it, not the year
     * that starts in the winter of jalali year.
     * @param {?} jYear full jalali year like 1397
     * @return {?}
     */
    function (jYear) {
        return jYear + 621;
    };
    /**
     * Converts georgian year to the jalali year. Output year is the jalali year that start within the Georgian year.
     * @param gYear full georgian year like 2018
     */
    /**
     * Converts georgian year to the jalali year. Output year is the jalali year that start within the Georgian year.
     * @param {?} gYear full georgian year like 2018
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.georgianYearToJalaliYear = /**
     * Converts georgian year to the jalali year. Output year is the jalali year that start within the Georgian year.
     * @param {?} gYear full georgian year like 2018
     * @return {?}
     */
    function (gYear) {
        return gYear - 621;
    };
    /**
     * this method converts Georgian date to the jalali date. Output is an object implementing SimpleDateInterface.
     *
     * ATTENTION: month number starts from 0, but day number starts from 1. Just like native javascript Date object.
     * @param gDate Georgian date as a javascript Date object.
     *
     * [Implementation in source code]{@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L149}
     */
    /**
     * this method converts Georgian date to the jalali date. Output is an object implementing SimpleDateInterface.
     *
     * ATTENTION: month number starts from 0, but day number starts from 1. Just like native javascript Date object.
     * @param {?} gDate Georgian date as a javascript Date object.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L149}
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.convertToJalali = /**
     * this method converts Georgian date to the jalali date. Output is an object implementing SimpleDateInterface.
     *
     * ATTENTION: month number starts from 0, but day number starts from 1. Just like native javascript Date object.
     * @param {?} gDate Georgian date as a javascript Date object.
     *
     * [Implementation in source code]{\@link https://github.com/sijad/ts-jalaali/blob/296a7c2fa1816a5bbb0b11bbe3eb03ebc17059f6/src/jalaali.ts#L149}
     * @return {?}
     */
    function (gDate) {
        /** @type {?} */
        var georgianYear = gDate.getFullYear();
        /** @type {?} */
        var jalaliYear = this.georgianYearToJalaliYear(georgianYear);
        /** @type {?} */
        var passedDays = this.numberOfPassedGDays(gDate);
        /** @type {?} */
        var numOfPassedDaysTo1Farvardin = this.numberOfPassedGDays(new Date(georgianYear, 2, this.firstDayOfJYearInMarch(jalaliYear)));
        /** @type {?} */
        var jalaliDay;
        /** @type {?} */
        var jalaliMonth;
        // Find number of days that passed since 1 Farvardin.
        /** @type {?} */
        var numOfDayInJYear = passedDays - numOfPassedDaysTo1Farvardin;
        if (numOfDayInJYear >= 0) {
            if (numOfDayInJYear <= 185) {
                // The first 6 months.
                jalaliMonth = div(numOfDayInJYear, 31);
                jalaliDay = mod(numOfDayInJYear, 31) + 1;
                return { year: jalaliYear, month: jalaliMonth, day: jalaliDay };
            }
            else {
                // The remaining months.
                numOfDayInJYear -= 186;
            }
        }
        else {
            // Previous Jalali year.
            jalaliYear -= 1;
            numOfDayInJYear += 179;
            if (this.validator.isJYearLeap(jalaliYear)) {
                numOfDayInJYear += 1;
            }
        }
        jalaliMonth = 6 + div(numOfDayInJYear, 30);
        jalaliDay = mod(numOfDayInJYear, 30) + 1;
        return { year: jalaliYear, month: jalaliMonth, day: jalaliDay };
    };
    /**
     * Converts a valid jalali date to a javascript Date object representing a equivalent Georgian date.
     * @param jYear a full Jalali year like 1397
     * @param jMonth starts from zero
     * @param jDay starts from 1
     * @throws InvalidJalaliDateError when inputted date is not a valid Jalali date.
     */
    /**
     * Converts a valid jalali date to a javascript Date object representing a equivalent Georgian date.
     * @throws InvalidJalaliDateError when inputted date is not a valid Jalali date.
     * @param {?} jYear a full Jalali year like 1397
     * @param {?} jMonth starts from zero
     * @param {?} jDay starts from 1
     * @return {?}
     */
    JalaliDateCalculatorService.prototype.convertToGeorgian = /**
     * Converts a valid jalali date to a javascript Date object representing a equivalent Georgian date.
     * @throws InvalidJalaliDateError when inputted date is not a valid Jalali date.
     * @param {?} jYear a full Jalali year like 1397
     * @param {?} jMonth starts from zero
     * @param {?} jDay starts from 1
     * @return {?}
     */
    function (jYear, jMonth, jDay) {
        if (!this.validator.isValidJDate(jYear, jMonth, jDay)) {
            throw new InvalidJalaliDateError();
        }
        return this.createGDateFromDays(this.numberOfPassedJDays(jYear, jMonth, jDay));
    };
    JalaliDateCalculatorService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    JalaliDateCalculatorService.ctorParameters = function () { return [
        { type: JalaliDateValidatorService }
    ]; };
    /** @nocollapse */ JalaliDateCalculatorService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function JalaliDateCalculatorService_Factory() { return new JalaliDateCalculatorService(i0.ɵɵinject(i1.JalaliDateValidatorService)); }, token: JalaliDateCalculatorService, providedIn: "root" });
    return JalaliDateCalculatorService;
}());
export { JalaliDateCalculatorService };
if (false) {
    /** @type {?} */
    JalaliDateCalculatorService.prototype.validator;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamFsYWxpLWRhdGUtY2FsY3VsYXRvci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXBlcnNpYW4vIiwic291cmNlcyI6WyJsaWIvSkRhdGUvamFsYWxpLWRhdGUtY2FsY3VsYXRvci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFDM0MsT0FBTyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFFakUsT0FBTyxFQUFDLDBCQUEwQixFQUFDLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7QUFNM0U7SUFLRSxxQ0FBbUIsU0FBcUM7UUFBckMsY0FBUyxHQUFULFNBQVMsQ0FBNEI7SUFBRyxDQUFDO0lBRTVEOzs7Ozs7Ozs7OztPQVdHOzs7Ozs7Ozs7Ozs7O0lBQ0gseURBQW1COzs7Ozs7Ozs7Ozs7SUFBbkIsVUFBb0IsS0FBVzs7WUFDdkIsTUFBTSxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDOztZQUM3QixLQUFLLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxHQUFHLE1BQU07O1lBQ3BDLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQzs7WUFDMUIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLFFBQVE7UUFDdkgsT0FBTyxNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsU0FBUyxFQUFF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U0FBUyxFQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVEOzs7Ozs7T0FNRzs7Ozs7Ozs7O0lBQ0gsdURBQWlCOzs7Ozs7OztJQUFqQixVQUFrQixLQUFhLEVBQUUsTUFBYyxFQUFFLElBQVk7UUFDM0QsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFBRSxNQUFNLElBQUksc0JBQXNCLEVBQUUsQ0FBQztTQUFFO1FBQzlGLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDakYsQ0FBQzs7Z0JBN0lGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBUk8sMEJBQTBCOzs7c0NBSmxDO0NBeUpDLEFBL0lELElBK0lDO1NBNUlZLDJCQUEyQjs7O0lBRTFCLGdEQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge2RpdiwgbW9kfSBmcm9tICcuL0FyaXRobWV0aWNVdGlscyc7XG5pbXBvcnQge0ludmFsaWRKYWxhbGlEYXRlRXJyb3J9IGZyb20gJy4vSW52YWxpZEphbGFsaURhdGUuZXJyb3InO1xuaW1wb3J0IHtTaW1wbGVEYXRlSW50ZXJmYWNlfSBmcm9tICcuL1NpbXBsZURhdGUuaW50ZXJmYWNlJztcbmltcG9ydCB7SmFsYWxpRGF0ZVZhbGlkYXRvclNlcnZpY2V9IGZyb20gJy4vamFsYWxpLWRhdGUtdmFsaWRhdG9yLnNlcnZpY2UnO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgY29udmVydHMgSmFsYWxpIGRhdGUgdG8gR2VvcmdpYW4gYW5kIHZhc2UgdmVyc2EuIFlvdSBjYW4gdXNlIGFsbCBvZiB0aGUgbWV0aG9kcyBhcyBzdGF0aWMgbWV0aG9kcy5cbiAqXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEphbGFsaURhdGVDYWxjdWxhdG9yU2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IocHVibGljIHZhbGlkYXRvcjogSmFsYWxpRGF0ZVZhbGlkYXRvclNlcnZpY2UpIHt9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdGhlIEp1bGlhbiBEYXkgbnVtYmVyIGZyb20gR3JlZ29yaWFuIG9yIEp1bGlhbiBjYWxlbmRhciBkYXRlcy5cbiAgICpcbiAgICogT25seSBzb21lIGNvZGUgY2xlYW5pbmcgYXBwbGllZCB0byB0aGUgc291cmNlIGNvZGUuXG4gICAqXG4gICAqIFRoZSBwcm9jZWR1cmUgd2FzIHRlc3RlZCB0byBiZSBnb29kIHNpbmNlIDEgTWFyY2gsIC0xMDAxMDAgKG9mIGJvdGggY2FsZW5kYXJzKSB1cCB0byBhIGZldyBtaWxsaW9uIHllYXJzIGludG8gdGhlIGZ1dHVyZS5cbiAgICpcbiAgICogQHBhcmFtIGdEYXRlIGFuIGluc3RhbmNlIG9mIGphdmFzY3JpcHQgZGF0ZSByZXByZXNlbnRpbmcgYSBHZW9yZ2lhbiBkYXRlLlxuICAgKlxuICAgKiBbSW1wbGVtZW50YXRpb24gaW4gc291cmNlIGNvZGVde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9zaWphZC90cy1qYWxhYWxpL2Jsb2IvMjk2YTdjMmZhMTgxNmE1YmJiMGIxMWJiZTNlYjAzZWJjMTcwNTlmNi9zcmMvamFsYWFsaS50cyNMMTk1fVxuXG4gICAqL1xuICBudW1iZXJPZlBhc3NlZEdEYXlzKGdEYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBnTW9udGggPSBnRGF0ZS5nZXRNb250aCgpIC0gNztcbiAgICBjb25zdCBnWWVhciA9IGdEYXRlLmdldEZ1bGxZZWFyKCkgKyAxMDAxMDA7XG4gICAgY29uc3QgZ01vbnRoRGl2ID0gZGl2KGdNb250aCwgNik7XG4gICAgY29uc3QgcmVzdWx0ID0gZGl2KChnWWVhciArIGdNb250aERpdikgKiAxNDYxLCA0KSArIGRpdigxNTMgKiBtb2QoZ01vbnRoICsgMTcsIDEyKSArIDIsIDUpICsgZ0RhdGUuZ2V0RGF0ZSgpIC0gMzQ4NDA0MDg7XG4gICAgcmV0dXJuIHJlc3VsdCAtIGRpdihkaXYoZ1llYXIgKyBnTW9udGhEaXYsIDEwMCkgKiAzLCA0KSArIDc1MjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIG51bWJlciBvZiBwYXNzZWQgZGF5cyBmcm9tIHNvdXJjZSBkYXkgaW4gamFsYWxpIGNhbGVuZGFyIHRvIHRoZSBnaXZlbiBqYWxhbGkgZGF0ZS5cbiAgICogQHBhcmFtIGpZZWFyIGZ1bGwgamFsYWxpIHllYXIgbGlrZSAxMzk3XG4gICAqIEBwYXJhbSBqTW9udGggc3RhcnRzIGZyb20gemVyb1xuICAgKiBAcGFyYW0gakRheSBkYXkgbnVtYmVyIHN0YXJ0cyBmcm9tIG9uZVxuICAgKi9cbiAgbnVtYmVyT2ZQYXNzZWRKRGF5cyhqWWVhcjogbnVtYmVyLCBqTW9udGg6IG51bWJlciwgakRheTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5udW1iZXJPZlBhc3NlZEdEYXlzKG5ldyBEYXRlKHRoaXMuamFsYWxpWWVhclRvR2VvcmdpYW5ZZWFyKGpZZWFyKSwgMiwgdGhpcy5maXJzdERheU9mSlllYXJJbk1hcmNoKGpZZWFyKSkpICtcbiAgICAgIGpNb250aCAqIDMxIC0gZGl2KGpNb250aCArIDEsIDcpICogKGpNb250aCAtIDYpICsgakRheSAtIDE7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGphdmFzY3JpcHQgRGF0ZSBvYmplY3QgZnJvbSBudW1iZXIgb2YgcGFzc2VkIGRheXMgaW4gR2VvcmdpYW4gY2FsZW5kYXIgcmVwcmVzZW50aW5nIEdlb3JnaWFuIGRhdGUuXG4gICAqXG4gICAqIFtJbXBsZW1lbnRhdGlvbiBpbiBzb3VyY2UgY29kZV17QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NpamFkL3RzLWphbGFhbGkvYmxvYi8yOTZhN2MyZmExODE2YTViYmIwYjExYmJlM2ViMDNlYmMxNzA1OWY2L3NyYy9qYWxhYWxpLnRzI0wyMTN9XG4gICAqL1xuICBjcmVhdGVHRGF0ZUZyb21EYXlzKG51bU9mRGF5czogbnVtYmVyKTogRGF0ZSB7XG4gICAgY29uc3QgaiA9ICg0ICogbnVtT2ZEYXlzICsgMTM5MzYxNjMxKSArIGRpdihkaXYoNCAqIG51bU9mRGF5cyArIDE4MzE4NzcyMCwgMTQ2MDk3KSAqIDMsIDQpICogNCAtIDM5MDg7XG4gICAgY29uc3QgaSA9IGRpdihtb2QoaiwgMTQ2MSksIDQpICogNSArIDMwODtcbiAgICBjb25zdCBnRGF5ID0gZGl2KG1vZChpLCAxNTMpLCA1KSArIDE7XG4gICAgY29uc3QgZ01vbnRoID0gbW9kKGRpdihpLCAxNTMpLCAxMik7XG4gICAgY29uc3QgZ1llYXIgPSBkaXYoaiwgMTQ2MSkgLSAxMDAxMDAgKyBkaXYoNyAtIGdNb250aCwgNik7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGdZZWFyLCBnTW9udGgsIGdEYXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBudW1iZXIgb2YgcGFzc2VkIGxlYXAgeWVhcnMgZnJvbSBBRCA2MjEgdW50aWwgdGFyZ2V0R1llYXIuXG4gICAqIEBwYXJhbSB0YXJnZXRHWWVhciBpcyBmdWxsIHllYXIgbnVtYmVyIGxpa2UgMjAxOFxuICAgKlxuICAgKiBbSW1wbGVtZW50YXRpb24gaW4gc291cmNlIGNvZGVde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9zaWphZC90cy1qYWxhYWxpL2Jsb2IvMjk2YTdjMmZhMTgxNmE1YmJiMGIxMWJiZTNlYjAzZWJjMTcwNTlmNi9zcmMvamFsYWFsaS50cyNMMTEwfVxuICAgKi9cbiAgbnVtT2ZHTGVhcFllYXJzKHRhcmdldEdZZWFyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBkaXYodGFyZ2V0R1llYXIsIDQpIC0gZGl2KChkaXYodGFyZ2V0R1llYXIsIDEwMCkgKyAxKSAqIDMsIDQpIC0gMTUwO1xuICB9XG5cbiAgLyoqXG4gICAqIGZpcnN0IGRheSBvZiB0aGUgRmFydmFyZGluIG1vbnRoIGluIEphbGFsaSBjYWxlbmRhciBpcyBpbiBNYXJjaCBtb250aC4gVGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZGF5IG51bWJlciBvZiBuZXcgamFsYWxpIHllYXIgaW4gTWFyY2guXG4gICAqIFRoZSBkYXkgbnVtYmVyIHN0YXJ0cyBmcm9tIDEgbm90IHplcm8gYW5kIGlzIGVxdWFsIHRvIHRoZSByZWFsIG51bWJlcnMgaW4gdGhlIGNhbGVuZGFyLlxuICAgKiBAcGFyYW0galllYXIgZnVsbCBqYWxhbGkgeWVhciBsaWtlIDEzOTdcbiAgICovXG4gIGZpcnN0RGF5T2ZKWWVhckluTWFyY2goalllYXIpOiBudW1iZXIge1xuICAgIGNvbnN0IGdZZWFyID0galllYXIgKyA2MjE7XG4gICAgcmV0dXJuIHRoaXMudmFsaWRhdG9yLm51bU9mSkxlYXBZZWFycyhqWWVhcikgLSB0aGlzLm51bU9mR0xlYXBZZWFycyhnWWVhcikgKyAyMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyBqYWxhbGkgeWVhciBudW1iZXIgdG8gdGhlIGdlb3JnaWFuIHllYXIuIE91dHB1dCB5ZWFyIGlzIHRoZSBnZW9yZ2lhbiB5ZWFyIHRoYXQgamFsYWxpIHllYXIgc3RhcnRzIHdpdGhpbiBpdCwgbm90IHRoZSB5ZWFyXG4gICAqIHRoYXQgc3RhcnRzIGluIHRoZSB3aW50ZXIgb2YgamFsYWxpIHllYXIuXG4gICAqIEBwYXJhbSBqWWVhciBmdWxsIGphbGFsaSB5ZWFyIGxpa2UgMTM5N1xuICAgKi9cbiAgamFsYWxpWWVhclRvR2VvcmdpYW5ZZWFyKGpZZWFyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBqWWVhciArIDYyMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyBnZW9yZ2lhbiB5ZWFyIHRvIHRoZSBqYWxhbGkgeWVhci4gT3V0cHV0IHllYXIgaXMgdGhlIGphbGFsaSB5ZWFyIHRoYXQgc3RhcnQgd2l0aGluIHRoZSBHZW9yZ2lhbiB5ZWFyLlxuICAgKiBAcGFyYW0gZ1llYXIgZnVsbCBnZW9yZ2lhbiB5ZWFyIGxpa2UgMjAxOFxuICAgKi9cbiAgZ2VvcmdpYW5ZZWFyVG9KYWxhbGlZZWFyKGdZZWFyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBnWWVhciAtIDYyMTtcbiAgfVxuXG4gIC8qKlxuICAgKiB0aGlzIG1ldGhvZCBjb252ZXJ0cyBHZW9yZ2lhbiBkYXRlIHRvIHRoZSBqYWxhbGkgZGF0ZS4gT3V0cHV0IGlzIGFuIG9iamVjdCBpbXBsZW1lbnRpbmcgU2ltcGxlRGF0ZUludGVyZmFjZS5cbiAgICpcbiAgICogQVRURU5USU9OOiBtb250aCBudW1iZXIgc3RhcnRzIGZyb20gMCwgYnV0IGRheSBudW1iZXIgc3RhcnRzIGZyb20gMS4gSnVzdCBsaWtlIG5hdGl2ZSBqYXZhc2NyaXB0IERhdGUgb2JqZWN0LlxuICAgKiBAcGFyYW0gZ0RhdGUgR2VvcmdpYW4gZGF0ZSBhcyBhIGphdmFzY3JpcHQgRGF0ZSBvYmplY3QuXG4gICAqXG4gICAqIFtJbXBsZW1lbnRhdGlvbiBpbiBzb3VyY2UgY29kZV17QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NpamFkL3RzLWphbGFhbGkvYmxvYi8yOTZhN2MyZmExODE2YTViYmIwYjExYmJlM2ViMDNlYmMxNzA1OWY2L3NyYy9qYWxhYWxpLnRzI0wxNDl9XG4gICAqL1xuICBjb252ZXJ0VG9KYWxhbGkoZ0RhdGU6IERhdGUpOiBTaW1wbGVEYXRlSW50ZXJmYWNlIHtcbiAgICBjb25zdCBnZW9yZ2lhblllYXIgPSBnRGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIGxldCBqYWxhbGlZZWFyID0gdGhpcy5nZW9yZ2lhblllYXJUb0phbGFsaVllYXIoZ2VvcmdpYW5ZZWFyKTtcbiAgICBjb25zdCBwYXNzZWREYXlzID0gdGhpcy5udW1iZXJPZlBhc3NlZEdEYXlzKGdEYXRlKTtcbiAgICBjb25zdCBudW1PZlBhc3NlZERheXNUbzFGYXJ2YXJkaW4gPSB0aGlzLm51bWJlck9mUGFzc2VkR0RheXMobmV3IERhdGUoZ2VvcmdpYW5ZZWFyLCAyLCB0aGlzLmZpcnN0RGF5T2ZKWWVhckluTWFyY2goamFsYWxpWWVhcikpKTtcblxuICAgIGxldCBqYWxhbGlEYXk6IG51bWJlcjtcbiAgICBsZXQgamFsYWxpTW9udGg6IG51bWJlcjtcblxuICAgIC8vIEZpbmQgbnVtYmVyIG9mIGRheXMgdGhhdCBwYXNzZWQgc2luY2UgMSBGYXJ2YXJkaW4uXG4gICAgbGV0IG51bU9mRGF5SW5KWWVhciA9IHBhc3NlZERheXMgLSBudW1PZlBhc3NlZERheXNUbzFGYXJ2YXJkaW47XG4gICAgaWYgKG51bU9mRGF5SW5KWWVhciA+PSAwKSB7XG4gICAgICBpZiAobnVtT2ZEYXlJbkpZZWFyIDw9IDE4NSkge1xuICAgICAgICAvLyBUaGUgZmlyc3QgNiBtb250aHMuXG4gICAgICAgIGphbGFsaU1vbnRoID0gZGl2KG51bU9mRGF5SW5KWWVhciwgMzEpO1xuICAgICAgICBqYWxhbGlEYXkgPSBtb2QobnVtT2ZEYXlJbkpZZWFyLCAzMSkgKyAxO1xuICAgICAgICByZXR1cm4gIHt5ZWFyOiBqYWxhbGlZZWFyLCBtb250aDogamFsYWxpTW9udGgsIGRheTogamFsYWxpRGF5fTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoZSByZW1haW5pbmcgbW9udGhzLlxuICAgICAgICBudW1PZkRheUluSlllYXIgLT0gMTg2O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQcmV2aW91cyBKYWxhbGkgeWVhci5cbiAgICAgIGphbGFsaVllYXIgLT0gMTtcbiAgICAgIG51bU9mRGF5SW5KWWVhciArPSAxNzk7XG4gICAgICBpZiAodGhpcy52YWxpZGF0b3IuaXNKWWVhckxlYXAoamFsYWxpWWVhcikpIHtcbiAgICAgICAgbnVtT2ZEYXlJbkpZZWFyICs9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIGphbGFsaU1vbnRoID0gNiArIGRpdihudW1PZkRheUluSlllYXIsIDMwKTtcbiAgICBqYWxhbGlEYXkgPSBtb2QobnVtT2ZEYXlJbkpZZWFyLCAzMCkgKyAxO1xuICAgIHJldHVybiB7eWVhcjogamFsYWxpWWVhciwgbW9udGg6IGphbGFsaU1vbnRoLCBkYXk6IGphbGFsaURheX07XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYSB2YWxpZCBqYWxhbGkgZGF0ZSB0byBhIGphdmFzY3JpcHQgRGF0ZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgZXF1aXZhbGVudCBHZW9yZ2lhbiBkYXRlLlxuICAgKiBAcGFyYW0galllYXIgYSBmdWxsIEphbGFsaSB5ZWFyIGxpa2UgMTM5N1xuICAgKiBAcGFyYW0gak1vbnRoIHN0YXJ0cyBmcm9tIHplcm9cbiAgICogQHBhcmFtIGpEYXkgc3RhcnRzIGZyb20gMVxuICAgKiBAdGhyb3dzIEludmFsaWRKYWxhbGlEYXRlRXJyb3Igd2hlbiBpbnB1dHRlZCBkYXRlIGlzIG5vdCBhIHZhbGlkIEphbGFsaSBkYXRlLlxuICAgKi9cbiAgY29udmVydFRvR2VvcmdpYW4oalllYXI6IG51bWJlciwgak1vbnRoOiBudW1iZXIsIGpEYXk6IG51bWJlcik6IERhdGUge1xuICAgIGlmICghdGhpcy52YWxpZGF0b3IuaXNWYWxpZEpEYXRlKGpZZWFyLCBqTW9udGgsIGpEYXkpKSB7IHRocm93IG5ldyBJbnZhbGlkSmFsYWxpRGF0ZUVycm9yKCk7IH1cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVHRGF0ZUZyb21EYXlzKHRoaXMubnVtYmVyT2ZQYXNzZWRKRGF5cyhqWWVhciwgak1vbnRoLCBqRGF5KSk7XG4gIH1cblxufVxuIl19